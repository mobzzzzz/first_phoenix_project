<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>피닉스 미니프로젝트</title>

    <!-- 부트 스트랩 적용 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
        </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" href="css/all_css.css">
    <!-- <script src="javaScript/all_script.js" type="module" ></script>
    <script type="module">
        import {hello} from '/javaScript/all_script';
        hello();
    </script> -->
    
    <script type="module">

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
        import { doc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"; // 문서 이름을 지정할 수 있게
        import { getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDz4wh7z369v-whnyYeWaI3quPab2hxFmA",
            authDomain: "phoenix-first-project.firebaseapp.com",
            projectId: "phoenix-first-project",
            storageBucket: "phoenix-first-project.appspot.com",
            messagingSenderId: "943608506043",
            appId: "1:943608506043:web:c6dc699ceedf5090406b9e"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 동작하기 시작

        // 목표 저장하기
        $("#button1").click(async function () {
            let text = $('#goalText').val()
            if (text == "") {
                // console.log("비어있음")
                alert("목표를 입력해주세요!");
            } else {
                let docs = { "content": text };
                // await adds(collection(db, "minsu-objective"), doc);
                let today = new Date();
                let time = `${today.getFullYear()}${today.getMonth() + 1}${today.getDate()}${today.getHours()}${today.getMinutes()}${today.getSeconds()}`;
                await setDoc(doc(db,"minsu-objective",time),docs);
                window.location.reload(); // 화면을 다시 불러와서 남아있는거 없애기
            }
        })

        // 목표 가져오기
        let docs_goal = await getDocs(collection(db, "minsu-objective"));
        docs_goal.forEach(element => {
            let rows = element.data();
            // console.log(rows["content"])
            let addText = `
            <li>${rows["content"]}</li>
            `;
            $('#postinglist').append(addText)
        });

        // 토글 
        $("#guestButton").click(async function () {
            // console.log("열자")
            $(`#postingGuest`).toggle();
            $(`#addGuest`).toggle();
            $(`#guestSubject`).toggle();
            if ($(`#postingGuest`).css("display") == "none") {
                $(`#guestButton`).text("방명록 열기")
            } else {
                $(`#guestButton`).text("방명록 닫기")
            }
        })

        // 방명록 저장하기
        $("#guestAdd").click(async function () {
            let idInput = $('#nicknameInput').val()
            let commentInput = $('#commentInput').val()

            // 날짜 및 시간
            let today = new Date();
            let year = today.getFullYear();
            let month = today.getMonth() + 1;
            let day = today.getDate();
            let hours = today.getHours(); // 시
            let minutes = today.getMinutes();  // 분
            let seconds = today.getSeconds();  // 초
            
            if (idInput=="" || commentInput==""){
                alert("별명 또는 댓글을 입력해주세요!");
            } else {
                let docs = {
                "idInput": idInput,
                "commentInput": commentInput,
                "year": year,
                "month": month,
                "day": day,
                "hours": hours,
                "minutes": minutes,
                "seconds": seconds
            };
            // await addDoc(collection(db, "minsu-guestbook"), doc);
    
            let time = `${year}${month}${day}${hours}${minutes}${seconds}`;
            await setDoc(doc(db,"minsu-objective",time),docs);
            window.location.reload(); // 화면을 다시 불러와서 남아있는거 없애기
            }
            

            // 디버깅
            // console.log("작동함")
            // alert("목표 저장 완료");

        })

        // 방명록 가져오기
        let docs_guest = await getDocs(collection(db, "minsu-guestbook"));

        docs_guest.forEach(element => {
            let rows = element.data();
            // console.log(rows["idInput"])
            let addText = `
    <div class="commentList">
        <p id="nicknameRead">${rows["idInput"]}</p>
        <p id="contentRead">${rows["commentInput"]}</p>
        <p id="timeRead">${rows["year"]}-${rows["month"]}-${rows["day"]} ${rows["hours"]}:${rows["minutes"]}:${rows["seconds"]}</p>
    </div>
    `;
            $('#postingGuest').append(addText)
        });

        // 동작하기 끝

    </script>
</head>

<body>
    <div class="subject">
        <h1>불사조를 소개합니다.</h1>
    </div>

    <div class="indicate_box">
        <div class="row row-cols-1 row-cols-md-4 g-4">
            <div class="col">
                <div class="card h-100">
                    <a href="jinwoo/index.html"><img
                            src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdgEvvJ%2FbtsGB2RcjLu%2FQFzSh5zafT9xg5PqC2lQn0%2Fimg.jpg"
                            class="card-img-top" alt="이미지 오류"></a>

                    <div class="card-body">
                        <p class="card-title">한줄 소개</p>

                    </div>
                    <div class="card-footer">
                        <p class="name">고진우</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card h-100">
                    <a href="jihoon/index.html"><img src="jaewon/images/profile_image3.jpeg" class="card-img-top"
                            alt="error"></a>
                    <div class="card-body">
                        <p class="card-title">한줄 소개</p>

                    </div>
                    <div class="card-footer">
                        <p class="name">권지훈</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card h-100">
                    <a href="jaewon/mypage.html"><img src="jaewon/images/profile_image2.jpeg" class="card-img-top"
                            alt="..."></a>
                    <div class="card-body">
                        <p class="card-title">한줄 소개</p>

                    </div>
                    <div class="card-footer">
                        <p class="name">노재원</p>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card h-100">
                    <a href="minsoo/index.html"><img
                            src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdgEvvJ%2FbtsGB2RcjLu%2FQFzSh5zafT9xg5PqC2lQn0%2Fimg.jpg"
                            class="card-img-top" alt="..."></a>
                    <div class="card-body">
                        <p class="card-title">한줄 소개</p>

                    </div>
                    <div class="card-footer">
                        <p class="name">최민수</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="goalBox">
        <div class="teamGoal">
            <h3>팀의 목표</h3>
        </div>
        <div class="goalList">
            <ul id="postinglist">
                <li>목표1</li>
                <li>목표2</li>
                <li>목표3</li>
            </ul>
            <div class="input-group mb-3" id="goalInput">
                <p>+</p>
                <input type="text" class="form-control" placeholder="" aria-label="content"
                    aria-describedby="button-addon2" id="goalText">
                <button class="btn btn-outline-secondary" type="button" id="button1">추가</button>
                <!-- onclick="goalAdd()" -->
            </div>
        </div>
    </div>

    <div class="guestBox">
        <div id="guestSubject" style="display: none;">
            <h3>방명록 내역</h3>
        </div>
        <div class="commentListBox" id="postingGuest" style="display: none;">
            <div class="commentList">
                <p id="nicknameRead" style="text-align: center;">작성자</p>
                <p id="contentRead" style="text-align: center;">내용</p>
                <p id="timeRead" style="text-align: center;">시간</p>
            </div>
        </div>

        <div class="commentBox" id="addGuest" style="display: none;">
            <input type="email" id="nicknameInput" placeholder="별명">
            <input type="text" id="commentInput" placeholder="내용">
            <button id="guestAdd">추가</button> <!-- onclick="guestAdd()" -->
        </div>
        <button id="guestButton">방명록 열기</button> <!-- onclick="guestOpenClose()" -->
    </div>
</body>

</html>